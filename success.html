<script>
async function handleSuccess() {
  const urlParams = new URLSearchParams(window.location.search);
  const sessionId = urlParams.get("session_id");

  if (!sessionId) {
    console.log("session_id ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚");
    return;
  }

  const res = await fetch(`/.netlify/functions/retrieve?session_id=${sessionId}`);
  const data = await res.json();

  // ğŸ”´ ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒç„¡åŠ¹ãªå ´åˆï¼ˆæœŸé™åˆ‡ã‚Œã‚„å†åˆ©ç”¨æ™‚ï¼‰
  if (data.error?.code === "checkout_not_active_session") {
    document.body.innerHTML = `
      <h2 style="color:red;">ã“ã®æ±ºæ¸ˆã‚»ãƒƒã‚·ãƒ§ãƒ³ã¯æœŸé™åˆ‡ã‚Œã§ã™ã€‚</h2>
      <p>ã‚‚ã†ä¸€åº¦è³¼å…¥ãƒšãƒ¼ã‚¸ã‹ã‚‰ãŠè©¦ã—ãã ã•ã„ã€‚</p>
    `;
    console.warn("Stripeã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒç„¡åŠ¹:", data.error.message);
    return;
  }

  // âœ… æ±ºæ¸ˆæˆåŠŸæ™‚
  if (data.paid) {
    console.log("æ±ºæ¸ˆæˆåŠŸ:", data.metadata);
    updateCell(data.metadata.cellKey, data.metadata);
  } else {
    console.log("æœªæ±ºæ¸ˆã¾ãŸã¯æƒ…å ±ä¸å®Œå…¨:", data);
  }
}

// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å®Ÿè¡Œ
handleSuccess();
</script>

